<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel de Control â€“ Fiesta</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0c0c2e;
  color: white;
  padding: 20px;
}

h1 {
  color: #ffd700;
  text-align: center;
}

.card {
  background: rgba(255,255,255,0.1);
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  text-align: left;
}

th {
  color: #ffd700;
}
</style>
</head>

<body>

<h1>ðŸŽ¬ Panel de Control â€“ Fiesta</h1>

<div class="card">
  <p>Total votos: <strong id="totalVotos">0</strong></p>
  <p>Total personas: <strong id="totalPersonas">0</strong></p>
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Fecha</th>
        <th>Horario</th>
        <th>Personas</th>
      </tr>
    </thead>
    <tbody id="tablaVotos"></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBvzP_3MIQJ7H2QJnPOpYCdWsXeeBHKNXk",
  authDomain: "encuesta-familiar-3c852.firebaseapp.com",
  projectId: "encuesta-familiar-3c852",
  storageBucket: "encuesta-familiar-3c852.firebasestorage.app",
  messagingSenderId: "847982132954",
  appId: "1:847982132954:web:03075adefdba31076cefe3"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

onSnapshot(collection(db, "votos"), (snapshot) => {
  let total = snapshot.size;
  let totalPersonas = 0;

  const fechas = { febrero: 0, marzo: 0 };
  const horarios = { tarde: 0, noche: 0 };
  const personas = { 1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0 };

  snapshot.forEach(doc => {
    const v = doc.data();

    // total personas
    totalPersonas += v.personas || 0;

    // fechas
    if (v.fecha?.toLowerCase().includes("febrero")) fechas.febrero++;
    if (v.fecha?.toLowerCase().includes("marzo")) fechas.marzo++;

    // horarios
    if (v.horario?.toLowerCase().includes("tarde")) horarios.tarde++;
    if (v.horario?.toLowerCase().includes("noche")) horarios.noche++;

    // personas
    if (personas[v.personas] !== undefined) {
      personas[v.personas]++;
    }
  });

  // Totales generales
  document.getElementById("currentVotesCount").textContent = total;
  document.getElementById("totalConfirmaciones").textContent = total;
  document.getElementById("totalPersonas").textContent = totalPersonas;

  // FECHAS
  const totalFechas = fechas.febrero + fechas.marzo;
  if (totalFechas > 0) {
    const pFeb = Math.round((fechas.febrero / totalFechas) * 100);
    const pMar = Math.round((fechas.marzo / totalFechas) * 100);

    document.getElementById("result_febrero").style.width = pFeb + "%";
    document.getElementById("percent_febrero").textContent = pFeb + "%";
    document.getElementById("count_febrero").textContent = fechas.febrero;

    document.getElementById("result_marzo").style.width = pMar + "%";
    document.getElementById("percent_marzo").textContent = pMar + "%";
    document.getElementById("count_marzo").textContent = fechas.marzo;
  }

  // HORARIOS
  const totalHorarios = horarios.tarde + horarios.noche;
  if (totalHorarios > 0) {
    const pT = Math.round((horarios.tarde / totalHorarios) * 100);
    const pN = Math.round((horarios.noche / totalHorarios) * 100);

    document.getElementById("result_tarde").style.width = pT + "%";
    document.getElementById("percent_tarde").textContent = pT + "%";
    document.getElementById("count_tarde").textContent = horarios.tarde;

    document.getElementById("result_noche").style.width = pN + "%";
    document.getElementById("percent_noche").textContent = pN + "%";
    document.getElementById("count_noche").textContent = horarios.noche;
  }

  // PERSONAS
  for (let i = 1; i <= 8; i++) {
    const pct = total ? Math.round((personas[i] / total) * 100) : 0;
    document.getElementById(`result_personas_${i}`).style.width = pct + "%";
    document.getElementById(`percent_personas_${i}`).textContent = pct + "%";
    document.getElementById(`count_personas_${i}`).textContent = personas[i];
  }
});

</script>

</body>
</html>

